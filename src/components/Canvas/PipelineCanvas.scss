@use '../../styles/variables' as *;

.pipeline-canvas {
  width: 100%;
  height: 100%;
  background: var(--color-bg-1);
  position: relative;

  // Pan mode cursor (spacebar pressed)
  &--pan-mode {
    cursor: grab !important;

    * {
      cursor: grab !important;
    }

    &:active {
      cursor: grabbing !important;

      * {
        cursor: grabbing !important;
      }
    }
  }

  // Override ReactFlow default styles to match Kedro-Viz theme
  .react-flow {
    background: var(--color-bg-1);
  }

  // Background pattern styling
  .react-flow__background {
    background-color: var(--color-bg-1);
  }

  // Controls styling
  .react-flow__controls {
    background: var(--color-bg-2);
    border: 1px solid var(--color-border-line);
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba($black-900, 0.1);

    button {
      background: var(--color-bg-2);
      border-bottom: 1px solid var(--color-border-line);
      color: var(--color-text);
      transition: all 0.2s ease;

      &:hover {
        background: var(--color-bg-3);
        color: var(--color-primary);
      }

      &:last-child {
        border-bottom: none;
      }

      svg {
        fill: currentColor;
      }
    }
  }

  // MiniMap styling
  .react-flow__minimap {
    background: var(--color-bg-2);
    border: 1px solid var(--color-border-line);

    .react-flow__minimap-mask {
      fill: var(--color-bg-alt);
    }

    .react-flow__minimap-node {
      fill: var(--color-node-custom);
      stroke: var(--color-border-line);
    }
  }

  // Edge styling - make edges easier to click
  .react-flow__edge {
    // Add invisible thick stroke for easier clicking
    &::before {
      content: '';
      position: absolute;
      top: -10px;
      bottom: -10px;
      left: -10px;
      right: -10px;
      cursor: pointer;
    }

    &-path {
      stroke: var(--color-connection);
      stroke-width: 3; // Increased from 2
      transition: stroke 0.2s ease, stroke-width 0.2s ease;
      cursor: pointer;

      // Add transparent wider stroke for click area
      &:hover {
        stroke-width: 4;
      }
    }

    // Interaction path - invisible but clickable
    path:first-child {
      stroke: transparent;
      stroke-width: 20px; // Wide click area
      cursor: pointer;
    }

    &.selected {
      .react-flow__edge-path {
        stroke: var(--color-primary);
        stroke-width: 4;
      }
    }

    &:hover {
      .react-flow__edge-path {
        stroke: var(--color-primary);
      }
    }
  }

  // Selection box styling
  .react-flow__selection {
    background: rgba($ocean-400, 0.08);
    border: 1px solid var(--color-primary);
  }

  // Node selection styling
  .react-flow__node {
    &.selected {
      .custom-node {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba($ocean-400, 0.2);
      }
    }
  }

  // Zoom pane overlay
  .react-flow__pane {
    cursor: default;
  }

  // Connection line styling
  .react-flow__connectionline {
    .react-flow__connection-path {
      stroke: var(--color-primary);
      stroke-width: 3;
      stroke-dasharray: 5, 5;
    }
  }

  // Invalid connection visual feedback
  &--invalid-connection {
    .react-flow__connectionline {
      .react-flow__connection-path {
        stroke: var(--color-error) !important;
        stroke-width: 4 !important;
        animation: invalidConnectionPulse 0.6s ease-in-out infinite;
      }
    }
  }
}

// Animation for invalid connection
@keyframes invalidConnectionPulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

// Empty state
.pipeline-canvas__empty {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: var(--color-text-alt);
  pointer-events: none;
  z-index: $zindex-ui;

  h3 {
    font-size: 1.25rem;
    margin: 0 0 0.5em;
    color: var(--color-text);
  }

  p {
    font-size: 0.875rem;
    margin: 0;
  }
}
